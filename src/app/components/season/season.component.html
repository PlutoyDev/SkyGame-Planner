<div class="sky-card">
  <div class="sky-card-header">
    <h1 class="h2 mb-0">{{ season.name }}</h1>
  </div>
</div>

<!-- Spirits -->
<div class="sky-card mt">
  <div class="sky-card-header">
    <h2 class="h3">Spirits</h2>
  </div>
  <div class="sky-card-body">
    <div class="scroll-x sky-flex">
      <!-- Guide tree -->
      <div class="tree-wrapper">
        <app-spirit-tree *ngIf="guide?.tree" [tree]="guide!.tree!" [name]="guide!.name" [highlight]="highlightTree === guide!.tree!.guid"></app-spirit-tree>
      </div>
      <!-- Traveling Spirit trees -->
      <ng-container *ngIf="spirits">
        <ng-container *ngFor="let spirit of spirits;">
          <div class="tree-wrapper" *ngIf="spirit.tree">
            <app-spirit-tree [tree]="spirit.tree" [name]="spirit.name" [highlight]="highlightTree === spirit.tree.guid">
              <!-- Link to spirit -->
              <div name>
                <a [routerLink]="['/spirit', spirit.guid]" [queryParams]="{ highlightTree: spirit.tree.guid }">
                  {{ spirit.name }}
                </a>
              </div>
            </app-spirit-tree>
          </div>
        </ng-container>
      </ng-container>
    </div>
  </div>
</div>

<!-- IAPs -->
<ng-container *ngIf="shops.length">
  <div class="sky-card mt">
    <div class="sky-card-header">
      <h2 class="h3">In-App Purchases</h2>
    </div>
    <div class="sky-card-body">
      <div class="grid grid-4" >
        <!-- Render IAPs in order of sorted shops. -->
        <ng-container *ngFor="let shop of shops">
          <ng-container *ngIf="shop.iaps?.length">
            <div class="sky-card p-rel" *ngFor="let iap of shop.iaps" [class.highlight]="iap.guid === highlightIap">
              <div class="sky-card-header">
                <h3 class="h4" [ngbTooltip]="iap.name" container="body">
                  {{ iap.name }}
                </h3>
              </div>
              <div class="sky-card-body">
                <!-- Returning -->
                <div class="item">
                  <mat-icon class="menu-icon" [fontIcon]="iap.returning ? 'undo' : 'grade'"></mat-icon>
                  <span class="menu-label">
                    <span *ngIf="iap.returning" class="c-partial">Returning IAP</span>
                    <span *ngIf="!iap.returning" class="c-full">New  IAP</span>
                  </span>
                </div>
                <!-- Location -->
                <div class="mt-half item">
                  <mat-icon class="menu-icon" [fontIcon]="'location_on'"></mat-icon>
                  <span class="menu-label">
                    <span *ngIf="shop.name">{{ shop.name }}</span>
                    <span *ngIf="!shop.name && shop.type === 'Store'">Premium Candle Store</span>
                    <span *ngIf="!shop.name && shop.type !== 'Store'">{{ shop.name ?? shop.spirit?.name }}</span>
                  </span>
                </div>
                <!-- Price -->
                <div class="mt-half item">
                  <mat-icon class="menu-icon" fontIcon="attach_money"></mat-icon>
                  <span class="menu-label" [ngbTooltip]="'Price of the IAP in USD.'" container="body">
                    {{ iap.price }}
                  </span>
                </div>
                <!-- Currencies -->
                <div class="mt-half item" *ngIf="iap.c || iap.sc || iap.sp">
                  <ng-container *ngIf="iap.c">
                    <mat-icon class="menu-icon" svgIcon="candle" [ngbTooltip]="'Regular candles'" container="body" placement="right"></mat-icon>
                    <span class="menu-label">
                      {{ iap.c }}
                    </span>
                  </ng-container>
                  <ng-container *ngIf="iap.sc">
                    <mat-icon class="menu-icon" svgIcon="season-candle" [ngbTooltip]="'Season candles'" container="body" placement="right"></mat-icon>
                    <span class="menu-label">
                      {{ iap.sc }}
                    </span>
                  </ng-container>
                  <ng-container *ngIf="iap.sp">
                    <mat-icon class="menu-icon seasonal" svgIcon="gift" [ngbTooltip]="'Gift Season Pass'" container="body" placement="right"></mat-icon>
                    <span class="menu-label">
                      {{ iap.sp }}
                    </span>
                  </ng-container>
                </div>
                <!-- Items -->
                <div class="mt-half item iap-items">
                  <div class="iap-item point d-inline-block p-rel" *ngFor="let item of iap.items" (click)="togglePurchased($event, iap)">
                    <app-item [item]="item" [ngbTooltip]="itemHover" placement="bottom" container="body"></app-item>
                    <mat-icon class="unlock-check" [class.unlocked]="item?.unlocked" [class.self]="iap.bought" fontIcon="done"></mat-icon>
                    <ng-template #itemHover>
                      <ng-container *ngIf="item">
                        <span class="ws-nw">{{item.name}}</span>
                      </ng-container>
                    </ng-template>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </ng-container>
      </div>
    </div>
  </div>
</ng-container>
