<div class="sky-card">
  <div class="sky-card-header">
    <h1 class="h2 mb-0">Events</h1>
  </div>
  <div class="sky-card-body">
    <a class="container d-inline-block" href="https://sky-children-of-the-light.fandom.com/wiki/Special_Events" target="_blank">
      <mat-icon class="menu-icon">question_mark</mat-icon>
      <span class="menu-label">Wiki</span>
    </a>
  </div>
</div>

<!-- Active events -->
<div class="sky-card mt" *ngIf="hasActiveEvents">
  <div class="sky-card-header">
    <h2 class="h3">Active events</h2>
  </div>
  <div class="sky-card-body">
    <div class="grid grid-4" *ngIf="hasActiveEvents">
      <div class="sky-card p-rel highlight" *ngFor="let event of activeEvents | keyvalue; let i = index;">
        <div class="sky-card-header">
          <h2 class="h3 mb-0">{{ event.value.name }}</h2>
        </div>
        <div class="sky-card-body">
          <!-- Image -->
          <div *ngIf="event.value.imageUrl" class="img sky-border-solid"
            [style.background-image]="'url('+event.value.imageUrl+')'"
            [style.background-position]="event.value.imagePosition || undefined">
          </div>
          <!-- Overview -->
          <a class="item link mt" *ngIf="lastInstances[event.value.guid]" [routerLink]="['/event-instance', $any(lastInstances[event.value.guid]).guid]">
            <mat-icon class="menu-icon">article</mat-icon>
            <span class="menu-label">
              Overview
              <span class="c-accent">({{ $any(lastInstances[event.value.guid]).date | dayjs:'YYYY' }})</span>
            </span>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Recurring -->
<div class="sky-card mt">
  <div class="sky-card-header">
    <h2 class="h3">Recurring events</h2>
  </div>
  <div class="sky-card-body">
    <div class="grid grid-4">
      <div class="sky-card p-rel" *ngFor="let event of recurring; let i = index;" [class.highlight]="!!activeEvents[event.guid]">
        <ng-container *ngTemplateOutlet="eventDiv; context: {$implicit: event}"></ng-container>
      </div>
    </div>
  </div>
</div>

<!-- Other -->
<div class="sky-card mt">
  <div class="sky-card-header">
    <h2 class="h3">Other events</h2>
  </div>
  <div class="sky-card-body">
    <div class="grid grid-4">
      <div class="sky-card p-rel" *ngFor="let event of old; let i = index;" [class.highlight]="!!activeEvents[event.guid]">
        <ng-container *ngTemplateOutlet="eventDiv; context: {$implicit: event}"></ng-container>
      </div>
    </div>
  </div>
</div>

<!-- Event template -->
<ng-template #eventDiv let-event>
  <div class="sky-card-header">
    <h2 class="h3">{{ event.name }}</h2>
  </div>
  <div class="sky-card-body">
    <!-- Image -->
    <div *ngIf="event.imageUrl" class="img sky-border-solid"
      [style.background-image]="'url('+event.imageUrl+')'"
      [style.background-position]="event.imagePosition || undefined">
    </div>
    <!-- List -->
    <a class="item link" [class.mt]="event.imageUrl" [routerLink]="['/event', event.guid]">
      <mat-icon class="menu-icon">article</mat-icon>
      <span class="menu-label">
        List
      </span>
    </a>
    <!-- Jump to last -->
    <a class="item link mt" *ngIf="lastInstances[event.guid]" [routerLink]="['/event-instance', $any(lastInstances[event.guid]).guid]">
      <mat-icon class="menu-icon">schedule</mat-icon>
      <span class="menu-label">
        Most recent
        <span class="c-accent">({{ $any(lastInstances[event.guid]).date | dayjs:'YYYY' }})</span>
      </span>
    </a>
  </div>
</ng-template>
